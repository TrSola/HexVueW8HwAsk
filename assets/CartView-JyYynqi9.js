import{g,o as a,a as n,b as e,t as i,F as I,i as D,j as _,k as R,v as E,h as N,r as M,d as v,w as F,n as O,f as C,l as T}from"./index-3pfCdd_z.js";import{u as j}from"./useModal-jqgM7aVb.js";import{a as b}from"./axios-L6U4YIEh.js";import{S as U}from"./main-tocUHDha.js";const W={class:"modal-dialog modal-xl",role:"document"},G={class:"modal-content border-0"},J={class:"modal-header bg-dark text-white"},K={class:"modal-title",id:"exampleModalLabel"},Q=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),X={class:"modal-body"},Y={class:"row"},Z={class:"col-sm-6"},ee=["src"],te={class:"col-sm-6"},se={class:"badge bg-primary rounded-pill"},oe={key:0,class:"h5"},le={key:1,class:"h6"},ae={key:2,class:"h5"},ne={class:"input-group"},de={__name:"userProductModal",props:["product"],emits:["add-to-cart"],setup(q,{expose:f,emit:p}){const{openModal:m,hideModal:V,modalRef:$}=j(),o=q,w=p,y=g(1),c=()=>{w("add-to-cart",o.product.id,y.value),y.value=1};return f({openModal:m,hideModal:V}),(u,P)=>(a(),n("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalRef",ref:$},[e("div",W,[e("div",G,[e("div",J,[e("h5",K,[e("span",null,i(o.product.title),1)]),Q]),e("div",X,[e("div",Y,[e("div",Z,[(a(!0),n(I,null,D(o.product.imagesUrl,x=>(a(),n("img",{class:"img-fluid",src:x,alt:"",key:x.id,style:{height:"200px",width:"200px","background-size":"cover","padding-right":"5px"}},null,8,ee))),128))]),e("div",te,[e("span",se,i(o.product.category),1),e("p",null,"商品描述："+i(o.product.description),1),e("p",null,"商品內容："+i(o.product.content),1),o.product.price?_("",!0):(a(),n("div",oe,i(o.product.origin_price)+" 元",1)),o.product.price?(a(),n("del",le,"原價 "+i(o.product.origin_price)+" 元",1)):_("",!0),o.product.price?(a(),n("div",ae,"現在只要 "+i(o.product.price)+" 元",1)):_("",!0),e("div",null,[e("div",ne,[R(e("input",{type:"number",class:"form-control","onUpdate:modelValue":P[0]||(P[0]=x=>y.value=x),min:"1"},null,512),[[E,y.value,void 0,{number:!0}]]),e("button",{type:"button",class:"btn btn-primary",onClick:c},"加入購物車(內)")])])])])])])])],512))}};var ie={VITE_APP_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_PATH:"aca101139",BASE_URL:"/HexHWw6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const re={class:"container"},ce={class:"mt-4"},ue={class:"table align-middle"},_e=e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"商品名稱"),e("th",null,"價格"),e("th")])],-1),pe={style:{width:"200px"}},me={key:0,class:"h5"},he={key:1,class:"h6"},ve={key:2,class:"h5"},fe={class:"btn-group btn-group-sm"},be=["onClick","disabled"],ge={key:0,class:"fas fa-spinner fa-pulse"},ye=["onClick","disabled"],xe={key:0,class:"fas fa-spinner fa-pulse"},ke={key:0,class:"text-end"},$e=e("h2",null,"先放一項商品試試吧",-1),Ce=[$e],Ve={key:1,class:"text-end"},we={class:"table align-middle"},Pe=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),Te=["onClick","disabled"],Be={key:0,class:"fas fa-spinner fa-pulse"},Me={key:0,class:"text-success"},Ue={class:"input-group input-group-sm"},Ie={class:"input-group mb-3"},De=["onUpdate:modelValue","onBlur","disabled"],Re={class:"input-group-text",id:"basic-addon2"},Ee={class:"text-end"},qe={key:0,class:"text-success"},Ae=e("td",{colspan:"3",class:"text-end"},"總計",-1),Se={class:"text-end"},Le={key:0},ze=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),He={class:"text-end text-success"},Ne={class:"my-5 row justify-content-center"},Fe={class:"mb-3"},Oe=e("label",{for:"email",class:"form-label"},"Email",-1),je={class:"mb-3"},We=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),Ge={class:"mb-3"},Je=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),Ke={class:"mb-3"},Qe=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Xe={class:"mb-3"},Ye=e("label",{for:"message",class:"form-label"},"留言",-1),Ze=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1),lt={__name:"CartView",setup(q){const f=U.mixin({toast:!0,position:"center",iconColor:"white",customClass:{popup:"colored-toast"},showConfirmButton:!1,timer:1500,timerProgressBar:!0}),{VITE_APP_URL:p,VITE_APP_PATH:m}=ie,V=g(null),$=g(null),o=g({loadingItem:""}),w=g([]),y=g({}),c=g({user:{name:"",email:"",tel:"",address:""},message:""}),u=g({}),P=()=>{const l=`${p}/api/${m}/products`;b.get(l).then(s=>{w.value=s.data.products}).catch(s=>{alert(s.response.data.message)})},x=l=>{const s=`${p}/api/${m}/product/${l}`;o.value.loadingItem=l,b.get(s).then(d=>{o.value.loadingItem="",y.value=d.data.product,$.value.openModal()}).catch(d=>{alert(d.response.data.message)})},A=(l,s=1)=>{const d=`${p}/api/${m}/cart`;o.value.loadingItem=l;const h={product_id:l,qty:s};$.value.hideModal(),b.post(d,{data:h}).then(()=>{o.value.loadingItem="",k(),f.fire({icon:"success",title:"已加入購物車"})}).catch(B=>{alert(B.response.data.message)})},S=l=>{o.value.loadingItem=l.id;const s=`${p}/api/${m}/cart/${l.id}`,d={product_id:l.product_id,qty:l.qty};b.put(s,{data:d}).then(()=>{f.fire({icon:"success",title:"已更新購物車"}),o.value.loadingItem="",k()}).catch(h=>{alert(h.response.data.message),o.value.loadingItem=""})},L=()=>{U.fire({title:"是否清空購物車?",showDenyButton:!0,confirmButtonText:"確認清空",denyButtonText:"再想想好了"}).then(s=>{s.isConfirmed?(f.fire({icon:"warning",title:"刪除成功"}),b.delete(l).then(()=>{k()}).catch(d=>{alert(d.response.data.message)})):s.isDenied&&f.fire({icon:"info",title:"已為您保留購物車內容"})}).catch(()=>{alert("伺服器錯誤")});const l=`${p}/api/${m}/carts`},k=()=>{const l=`${p}/api/${m}/cart`;b.get(l).then(s=>{u.value=s.data.data}).catch(s=>{alert(s.response.data.message)})},z=l=>{U.fire({title:"確認要刪除",showDenyButton:!0,confirmButtonText:"確認刪除",denyButtonText:"再想想好了"}).then(d=>{d.isConfirmed?(o.value.loadingItem=l,f.fire({icon:"warning",title:"刪除成功"}),b.delete(s).then(()=>{o.value.loadingItem="",k()}).catch(h=>{alert(h.response.data.message)})):d.isDenied&&f.fire({icon:"info",title:"已為您保留該品項"})});const s=`${p}/api/${m}/cart/${l}`},H=()=>{if(u.value.carts.length===0)alert("購物車內沒有品項");else{const l=`${p}/api/${m}/order`,s=c.value;b.post(l,{data:s}).then(d=>{alert(d.data.message),V.value.resetForm(),k()}).catch(d=>{alert(d.response.data.message)})}};return N(()=>{P(),k()}),(l,s)=>{const d=M("v-field"),h=M("error-message"),B=M("v-form");return a(),n("div",re,[e("div",ce,[v(de,{ref_key:"userProductModalRef",ref:$,product:y.value,onAddToCart:A},null,8,["product"]),e("table",ue,[_e,e("tbody",null,[(a(!0),n(I,null,D(w.value,t=>(a(),n("tr",{key:t.id},[e("td",pe,[e("div",{style:O([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${t.imageUrl})`}])},null,4)]),e("td",null,i(t.title),1),e("td",null,[t.price?_("",!0):(a(),n("div",me,i(t.origin_price)+" 元 ",1)),t.price?(a(),n("del",he,"原價 "+i(t.origin_price)+" 元",1)):_("",!0),t.price?(a(),n("div",ve," 現在只要 "+i(t.price)+" 元 ",1)):_("",!0)]),e("td",null,[e("div",fe,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:r=>x(t.id),disabled:o.value.loadingItem===t.id||!t.is_enabled},[o.value.loadingItem===t.id?(a(),n("i",ge)):_("",!0),C(" 查看更多 ")],8,be),e("button",{type:"button",class:"btn btn-outline-danger",onClick:r=>A(t.id),disabled:o.value.loadingItem===t.id||!t.is_enabled},[o.value.loadingItem===t.id?(a(),n("i",xe)):_("",!0),C(" 加到購物車 ")],8,ye)])])]))),128))])]),u.value.carts&&u.value.carts.length===0?(a(),n("div",ke,Ce)):(a(),n("div",Ve,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:L}," 清空購物車 ")])),e("table",we,[Pe,e("tbody",null,[u.value.carts?(a(!0),n(I,{key:0},D(u.value.carts,t=>(a(),n("tr",{key:t.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>z(t.id),disabled:o.value.loadingItem===t.id},[o.value.loadingItem===t.id?(a(),n("i",Be)):_("",!0),C(" x ")],8,Te)]),e("td",null,[C(i(t.product.title)+" ",1),t.coupon?(a(),n("div",Me," 已套用優惠券 ")):_("",!0)]),e("td",null,[e("div",Ue,[e("div",Ie,[R(e("input",{"onUpdate:modelValue":r=>t.qty=r,onBlur:r=>S(t),disabled:o.value.loadingItem===t.id,min:"1",type:"number",class:"form-control"},null,40,De),[[E,t.qty,void 0,{number:!0}]]),e("span",Re,i(t.product.unit),1)])])]),e("td",Ee,[u.value.final_total!==u.value.total?(a(),n("small",qe,"折扣價：")):_("",!0),C(" "+i(t.final_total),1)])]))),128)):_("",!0)]),e("tfoot",null,[e("tr",null,[Ae,e("td",Se,i(u.value.total),1)]),u.value.final_total!==u.value.total?(a(),n("tr",Le,[ze,e("td",He,i(u.value.final_total),1)])):_("",!0)])])]),e("div",Ne,[v(B,{ref_key:"formRef",ref:V,class:"col-md-6",onSubmit:H},{default:F(({errors:t})=>[e("div",Fe,[Oe,v(d,{id:"email",name:"email",type:"email",class:T(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:c.value.user.email,"onUpdate:modelValue":s[0]||(s[0]=r=>c.value.user.email=r)},null,8,["class","modelValue"]),v(h,{name:"email",class:"invalid-feedback"})]),e("div",je,[We,v(d,{id:"name",name:"姓名",type:"text",class:T(["form-control",{"is-invalid":t.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:c.value.user.name,"onUpdate:modelValue":s[1]||(s[1]=r=>c.value.user.name=r)},null,8,["class","modelValue"]),v(h,{name:"姓名",class:"invalid-feedback"})]),e("div",Ge,[Je,v(d,{id:"tel",name:"電話",type:"text",class:T(["form-control",{"is-invalid":t.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:c.value.user.tel,"onUpdate:modelValue":s[2]||(s[2]=r=>c.value.user.tel=r)},null,8,["class","modelValue"]),v(h,{name:"電話",class:"invalid-feedback"})]),e("div",Ke,[Qe,v(d,{id:"address",name:"地址",type:"text",class:T(["form-control",{"is-invalid":t.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:c.value.user.address,"onUpdate:modelValue":s[3]||(s[3]=r=>c.value.user.address=r)},null,8,["class","modelValue"]),v(h,{name:"地址",class:"invalid-feedback"})]),e("div",Xe,[Ye,R(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[4]||(s[4]=r=>c.value.message=r)},null,512),[[E,c.value.message]])]),Ze]),_:1},512)])])}}};export{lt as default};
