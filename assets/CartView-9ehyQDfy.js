import{g as x,a,c as n,e as t,t as d,F as P,k as S,h as u,l as I,v as T,s as q,o as H,r as N,b as D,u as p,w as z,n as F,d as k}from"./index-j-sR0IBE.js";import{u as O}from"./useModal-JSSl3kzZ.js";import{a as g}from"./axios-L6U4YIEh.js";import{S as m}from"./sweetAlertStore-GXxe6EqM.js";import{S as E}from"./sweetalert2.all-G9KK9VDN.js";import{u as j}from"./cartStore-Fc_i5i4P.js";const W={class:"modal-dialog modal-xl",role:"document"},G={class:"modal-content border-0"},J={class:"modal-header bg-dark text-white"},K={class:"modal-title",id:"exampleModalLabel"},Q=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),X={class:"modal-body"},Y={class:"row"},Z={class:"col-sm-6"},tt=["src"],et={class:"col-sm-6"},st={class:"badge bg-primary rounded-pill"},ot={key:0,class:"h5"},at={key:1,class:"h6"},nt={key:2,class:"h5"},lt={class:"input-group"},dt={__name:"userProductModal",props:["product"],emits:["add-to-cart"],setup(V,{expose:_,emit:h}){const{openModal:$,hideModal:l,modalRef:M}=O(),c=V,C=h,y=x(1),r=()=>{C("add-to-cart",c.product.id,y.value),y.value=1};return _({openModal:$,hideModal:l}),(B,w)=>(a(),n("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalRef",ref:M},[t("div",W,[t("div",G,[t("div",J,[t("h5",K,[t("span",null,d(c.product.title),1)]),Q]),t("div",X,[t("div",Y,[t("div",Z,[(a(!0),n(P,null,S(c.product.imagesUrl,v=>(a(),n("img",{class:"img-fluid",src:v,alt:"",key:v.id,style:{height:"200px",width:"200px","background-size":"cover","padding-right":"5px"}},null,8,tt))),128))]),t("div",et,[t("span",st,d(c.product.category),1),t("p",null,"商品描述："+d(c.product.description),1),t("p",null,"商品內容："+d(c.product.content),1),c.product.price?u("",!0):(a(),n("div",ot,d(c.product.origin_price)+" 元",1)),c.product.price?(a(),n("del",at,"原價 "+d(c.product.origin_price)+" 元",1)):u("",!0),c.product.price?(a(),n("div",nt,"現在只要 "+d(c.product.price)+" 元",1)):u("",!0),t("div",null,[t("div",lt,[I(t("input",{type:"number",class:"form-control","onUpdate:modelValue":w[0]||(w[0]=v=>y.value=v),min:"1"},null,512),[[T,y.value,void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:r},"加入購物車(內)")])])])])])])])],512))}};var ct={VITE_APP_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_PATH:"aca101139",BASE_URL:"/HexVueW8HwAsk/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const it={class:"container"},rt={class:"mt-4"},ut={class:"table align-middle"},pt=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),_t={style:{width:"200px"}},ht={key:0,class:"h5"},gt={key:1,class:"h6"},mt={key:2,class:"h5"},vt={class:"btn-group btn-group-sm"},bt=["onClick","disabled"],ft={key:0,class:"fas fa-spinner fa-pulse"},yt=["onClick","disabled"],kt={key:0,class:"fas fa-spinner fa-pulse"},xt={key:0,class:"text-end"},$t=t("h2",null,"試試放一項商品吧",-1),Ct=[$t],Mt={key:1,class:"text-end"},wt={class:"table align-middle"},Pt=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1),St=["onClick","disabled"],It={key:0,class:"fas fa-spinner fa-pulse"},Tt={key:0,class:"text-success"},Vt={class:"input-group input-group-sm"},Bt={class:"input-group mb-3"},Dt=["onUpdate:modelValue","onBlur","disabled"],Et={class:"input-group-text",id:"basic-addon2"},At={class:"text-end"},Rt={key:0,class:"text-success"},Ut=t("td",{colspan:"3",class:"text-end"},"總計",-1),Lt={class:"text-end"},qt={key:0},Ht=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Nt={class:"text-end text-success"},zt={class:"input-group mb-3 input-group-sm"},Ft={class:"d-flex justify-content-end mb-5"},Qt={__name:"CartView",setup(V){const{VITE_APP_URL:_,VITE_APP_PATH:h}=ct,$=x(null),l=x({loadingItem:""}),M=x([]),c=x({}),C=x(""),y=j(),{carts:r}=q(y),B=()=>{const o=`${_}/api/${h}/products`;g.get(o).then(s=>{M.value=s.data.products}).catch(s=>{alert(s.response.data.message)})},w=o=>{const s=`${_}/api/${h}/product/${o}`;l.value.loadingItem=o,g.get(s).then(i=>{l.value.loadingItem="",c.value=i.data.product,$.value.openModal()}).catch(i=>{alert(i.response.data.message)})},v=(o,s=1)=>{const i=`${_}/api/${h}/cart`;l.value.loadingItem=o;const e={product_id:o,qty:s};$.value.hideModal(),g.post(i,{data:e}).then(()=>{l.value.loadingItem="",b(),m.showSuccessMsg("已加入購物車")}).catch(f=>{alert(f.response.data.message)})},A=o=>{l.value.loadingItem=o.id;const s=`${_}/api/${h}/cart/${o.id}`,i={product_id:o.product_id,qty:o.qty};g.put(s,{data:i}).then(()=>{m.showSuccessMsg("已更新購物車"),l.value.loadingItem="",b()}).catch(e=>{alert(e.response.data.message),l.value.loadingItem=""})},R=()=>{E.fire({title:"是否清空購物車?",showDenyButton:!0,confirmButtonText:"確認清空",denyButtonText:"再想想好了"}).then(s=>{s.isConfirmed?(m.showSuccessMsg("刪除成功"),g.delete(o).then(()=>{b()}).catch(i=>{alert(i.response.data.message)})):s.isDenied&&m.showErrorMsg("已為您保留購物車")}).catch(()=>{alert("伺服器錯誤")});const o=`${_}/api/${h}/carts`},b=()=>{const o=`${_}/api/${h}/cart`;g.get(o).then(s=>{r.value=s.data.data}).catch(s=>{alert(s.response.data.message)})},U=o=>{E.fire({title:"確認要刪除",showDenyButton:!0,confirmButtonText:"確認刪除",denyButtonText:"再想想好了"}).then(i=>{i.isConfirmed?(l.value.loadingItem=o,m.showSuccessMsg("刪除成功"),g.delete(s).then(()=>{l.value.loadingItem="",b()}).catch(e=>{alert(e.response.data.message)})):i.isDenied&&m.showErrorMsg("已為您保留該品項")});const s=`${_}/api/${h}/cart/${o}`},L=()=>{const o=`${_}/api/${h}/coupon`,s={code:C.value};l.value.loadingItem="",g.post(o,{data:s}).then(i=>{m.showSuccessMsg("已加入優惠券"),b(),l.value.loadingItem=""}).catch(()=>{l.value.loadingItem="",m.showErrorMsg("加入優惠券失敗"),b()})};return H(()=>{B(),b()}),(o,s)=>{const i=N("router-link");return a(),n("div",it,[t("div",rt,[D(dt,{ref_key:"userProductModalRef",ref:$,product:c.value,onAddToCart:v},null,8,["product"]),t("table",ut,[pt,t("tbody",null,[(a(!0),n(P,null,S(M.value,e=>(a(),n("tr",{key:e.id},[t("td",_t,[t("div",{style:F([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${e.imageUrl})`}])},null,4)]),t("td",null,d(e.title),1),t("td",null,[e.price?u("",!0):(a(),n("div",ht,d(e.origin_price)+" 元 ",1)),e.price?(a(),n("del",gt,"原價 "+d(e.origin_price)+" 元",1)):u("",!0),e.price?(a(),n("div",mt," 現在只要 "+d(e.price)+" 元 ",1)):u("",!0)]),t("td",null,[t("div",vt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:f=>w(e.id),disabled:l.value.loadingItem===e.id||!e.is_enabled},[l.value.loadingItem===e.id?(a(),n("i",ft)):u("",!0),k(" 查看更多 ")],8,bt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:f=>v(e.id),disabled:l.value.loadingItem===e.id||!e.is_enabled},[l.value.loadingItem===e.id?(a(),n("i",kt)):u("",!0),k(" 加到購物車 ")],8,yt)])])]))),128))])]),p(r).carts&&p(r).carts.length===0?(a(),n("div",xt,Ct)):(a(),n("div",Mt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:R}," 清空購物車 ")])),t("table",wt,[Pt,t("tbody",null,[p(r).carts?(a(!0),n(P,{key:0},S(p(r).carts,e=>(a(),n("tr",{key:e.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:f=>U(e.id),disabled:l.value.loadingItem===e.id},[l.value.loadingItem===e.id?(a(),n("i",It)):u("",!0),k(" x ")],8,St)]),t("td",null,[k(d(e.product.title)+" ",1),e.coupon?(a(),n("div",Tt," 已套用優惠券 ")):u("",!0)]),t("td",null,[t("div",Vt,[t("div",Bt,[I(t("input",{"onUpdate:modelValue":f=>e.qty=f,onBlur:f=>A(e),disabled:l.value.loadingItem===e.id,min:"1",type:"number",class:"form-control"},null,40,Dt),[[T,e.qty,void 0,{number:!0}]]),t("span",Et,d(e.product.unit),1)])])]),t("td",At,[p(r).final_total!==p(r).total?(a(),n("small",Rt,"折扣價：")):u("",!0),k(" "+d(Math.floor(p(r).final_total)),1)])]))),128)):u("",!0)]),t("tfoot",null,[t("tr",null,[Ut,t("td",Lt,d(p(r).total),1)]),p(r).final_total!==p(r).total?(a(),n("tr",qt,[Ht,t("td",Nt,d(Math.floor(p(r).final_total)),1)])):u("",!0)])]),t("div",zt,[I(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=e=>C.value=e),placeholder:"請輸入優惠碼"},null,512),[[T,C.value]]),t("div",{class:"input-group-append"},[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:L}," 套用優惠碼 ")])]),t("div",Ft,[D(i,{to:"/checkOut",class:"btn btn-primary"},{default:z(()=>[k("去結帳")]),_:1})])])])}}};export{Qt as default};
