import{g as w,a as s,c as o,e as t,t as r,F as T,k as S,h as p,l as D,v as E,s as U,o as L,r as q,b as I,u as h,w as H,n as O,d as x}from"./index-Hq070Y_W.js";import{u as N}from"./useModal-TVMD7fgL.js";import{a as f}from"./axios-L6U4YIEh.js";import{S as m}from"./sweetalert2.all-S_ds1dXQ.js";import{u as z}from"./cartStore-su4-pP_n.js";const F={class:"modal-dialog modal-xl",role:"document"},W={class:"modal-content border-0"},j={class:"modal-header bg-dark text-white"},G={class:"modal-title",id:"exampleModalLabel"},J=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),K={class:"modal-body"},Q={class:"row"},X={class:"col-sm-6"},Y=["src"],Z={class:"col-sm-6"},tt={class:"badge bg-primary rounded-pill"},et={key:0,class:"h5"},st={key:1,class:"h6"},ot={key:2,class:"h5"},nt={class:"input-group"},at={__name:"userProductModal",props:["product"],emits:["add-to-cart"],setup(g,{expose:d,emit:_}){const{openModal:v,hideModal:l,modalRef:M}=N(),c=g,P=_,i=w(1),B=()=>{P("add-to-cart",c.product.id,i.value),i.value=1};return d({openModal:v,hideModal:l}),(V,$)=>(s(),o("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalRef",ref:M},[t("div",F,[t("div",W,[t("div",j,[t("h5",G,[t("span",null,r(c.product.title),1)]),J]),t("div",K,[t("div",Q,[t("div",X,[(s(!0),o(T,null,S(c.product.imagesUrl,y=>(s(),o("img",{class:"img-fluid",src:y,alt:"",key:y.id,style:{height:"200px",width:"200px","background-size":"cover","padding-right":"5px"}},null,8,Y))),128))]),t("div",Z,[t("span",tt,r(c.product.category),1),t("p",null,"商品描述："+r(c.product.description),1),t("p",null,"商品內容："+r(c.product.content),1),c.product.price?p("",!0):(s(),o("div",et,r(c.product.origin_price)+" 元",1)),c.product.price?(s(),o("del",st,"原價 "+r(c.product.origin_price)+" 元",1)):p("",!0),c.product.price?(s(),o("div",ot,"現在只要 "+r(c.product.price)+" 元",1)):p("",!0),t("div",null,[t("div",nt,[D(t("input",{type:"number",class:"form-control","onUpdate:modelValue":$[0]||($[0]=y=>i.value=y),min:"1"},null,512),[[E,i.value,void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:B},"加入購物車(內)")])])])])])])])],512))}},k={showErrorMsg:function(g){m.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,didOpen:d=>{d.onmouseenter=m.stopTimer,d.onmouseleave=m.resumeTimer}}).fire({icon:"error",title:g})},showSuccessMsg:function(g){m.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,didOpen:d=>{d.onmouseenter=m.stopTimer,d.onmouseleave=m.resumeTimer}}).fire({icon:"success",title:g})},confirm:function(g,d,_){m.fire({title:g,text:d,showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(v=>{v.isConfirmed&&_&&_()})}};var lt={VITE_APP_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_PATH:"aca101139",BASE_URL:"/HexVueW8HwAsk/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const dt={class:"container"},it={class:"mt-4"},rt={class:"table align-middle"},ct=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),ut={style:{width:"200px"}},pt={key:0,class:"h5"},_t={key:1,class:"h6"},ht={key:2,class:"h5"},mt={class:"btn-group btn-group-sm"},gt=["onClick","disabled"],vt={key:0,class:"fas fa-spinner fa-pulse"},bt=["onClick","disabled"],ft={key:0,class:"fas fa-spinner fa-pulse"},yt={key:0,class:"text-end"},xt=t("h2",null,"試試放一項商品吧",-1),kt=[xt],$t={key:1,class:"text-end"},Ct={class:"table align-middle"},wt=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1),Mt=["onClick","disabled"],Tt={key:0,class:"fas fa-spinner fa-pulse"},Pt={key:0,class:"text-success"},Bt={class:"input-group input-group-sm"},St={class:"input-group mb-3"},Vt=["onUpdate:modelValue","onBlur","disabled"],It={class:"input-group-text",id:"basic-addon2"},Dt={class:"text-end"},Et={key:0,class:"text-success"},At=t("td",{colspan:"3",class:"text-end"},"總計",-1),Rt={class:"text-end"},Ut={key:0},Lt=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),qt={class:"text-end text-success"},Wt={__name:"CartView",setup(g){const{VITE_APP_URL:d,VITE_APP_PATH:_}=lt,v=w(null),l=w({loadingItem:""}),M=w([]),c=w({}),P=z(),{carts:i}=U(P),B=()=>{const n=`${d}/api/${_}/products`;f.get(n).then(a=>{M.value=a.data.products}).catch(a=>{alert(a.response.data.message)})},V=n=>{const a=`${d}/api/${_}/product/${n}`;l.value.loadingItem=n,f.get(a).then(u=>{l.value.loadingItem="",c.value=u.data.product,v.value.openModal()}).catch(u=>{alert(u.response.data.message)})},$=(n,a=1)=>{const u=`${d}/api/${_}/cart`;l.value.loadingItem=n;const e={product_id:n,qty:a};v.value.hideModal(),f.post(u,{data:e}).then(()=>{l.value.loadingItem="",C(),k.showSuccessMsg("已加入購物車")}).catch(b=>{alert(b.response.data.message)})},y=n=>{l.value.loadingItem=n.id;const a=`${d}/api/${_}/cart/${n.id}`,u={product_id:n.product_id,qty:n.qty};f.put(a,{data:u}).then(()=>{k.showSuccessMsg("已更新購物車"),l.value.loadingItem="",C()}).catch(e=>{alert(e.response.data.message),l.value.loadingItem=""})},A=()=>{m.fire({title:"是否清空購物車?",showDenyButton:!0,confirmButtonText:"確認清空",denyButtonText:"再想想好了"}).then(a=>{a.isConfirmed?(k.showSuccessMsg("刪除成功"),f.delete(n).then(()=>{C()}).catch(u=>{alert(u.response.data.message)})):a.isDenied&&k.showErrorMsg("已為您保留購物車")}).catch(()=>{alert("伺服器錯誤")});const n=`${d}/api/${_}/carts`},C=()=>{const n=`${d}/api/${_}/cart`;f.get(n).then(a=>{i.value=a.data.data}).catch(a=>{alert(a.response.data.message)})},R=n=>{m.fire({title:"確認要刪除",showDenyButton:!0,confirmButtonText:"確認刪除",denyButtonText:"再想想好了"}).then(u=>{u.isConfirmed?(l.value.loadingItem=n,k.showSuccessMsg("刪除成功"),f.delete(a).then(()=>{l.value.loadingItem="",C()}).catch(e=>{alert(e.response.data.message)})):u.isDenied&&k.showErrorMsg("已為您保留該品項")});const a=`${d}/api/${_}/cart/${n}`};return L(()=>{B(),C()}),(n,a)=>{const u=q("router-link");return s(),o(T,null,[t("div",dt,[t("div",it,[I(at,{ref_key:"userProductModalRef",ref:v,product:c.value,onAddToCart:$},null,8,["product"]),t("table",rt,[ct,t("tbody",null,[(s(!0),o(T,null,S(M.value,e=>(s(),o("tr",{key:e.id},[t("td",ut,[t("div",{style:O([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${e.imageUrl})`}])},null,4)]),t("td",null,r(e.title),1),t("td",null,[e.price?p("",!0):(s(),o("div",pt,r(e.origin_price)+" 元 ",1)),e.price?(s(),o("del",_t,"原價 "+r(e.origin_price)+" 元",1)):p("",!0),e.price?(s(),o("div",ht," 現在只要 "+r(e.price)+" 元 ",1)):p("",!0)]),t("td",null,[t("div",mt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:b=>V(e.id),disabled:l.value.loadingItem===e.id||!e.is_enabled},[l.value.loadingItem===e.id?(s(),o("i",vt)):p("",!0),x(" 查看更多 ")],8,gt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:b=>$(e.id),disabled:l.value.loadingItem===e.id||!e.is_enabled},[l.value.loadingItem===e.id?(s(),o("i",ft)):p("",!0),x(" 加到購物車 ")],8,bt)])])]))),128))])]),h(i).carts&&h(i).carts.length===0?(s(),o("div",yt,kt)):(s(),o("div",$t,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:A}," 清空購物車 ")])),t("table",Ct,[wt,t("tbody",null,[h(i).carts?(s(!0),o(T,{key:0},S(h(i).carts,e=>(s(),o("tr",{key:e.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:b=>R(e.id),disabled:l.value.loadingItem===e.id},[l.value.loadingItem===e.id?(s(),o("i",Tt)):p("",!0),x(" x ")],8,Mt)]),t("td",null,[x(r(e.product.title)+" ",1),e.coupon?(s(),o("div",Pt," 已套用優惠券 ")):p("",!0)]),t("td",null,[t("div",Bt,[t("div",St,[D(t("input",{"onUpdate:modelValue":b=>e.qty=b,onBlur:b=>y(e),disabled:l.value.loadingItem===e.id,min:"1",type:"number",class:"form-control"},null,40,Vt),[[E,e.qty,void 0,{number:!0}]]),t("span",It,r(e.product.unit),1)])])]),t("td",Dt,[h(i).final_total!==h(i).total?(s(),o("small",Et,"折扣價：")):p("",!0),x(" "+r(e.final_total),1)])]))),128)):p("",!0)]),t("tfoot",null,[t("tr",null,[At,t("td",Rt,r(h(i).total),1)]),h(i).final_total!==h(i).total?(s(),o("tr",Ut,[Lt,t("td",qt,r(h(i).final_total),1)])):p("",!0)])])])]),I(u,{to:"/checkOut",class:"btn btn-primary"},{default:H(()=>[x("去結帳")]),_:1})],64)}}};export{Wt as default};
