import{g as x,a as s,c as o,e as t,t as r,F as P,k as S,h as i,l as I,v as T,s as q,o as H,r as N,b as D,u as c,w as z,n as F,d as k}from"./index-jyK5pwc8.js";import{u as O}from"./useModal-SLCnVXm8.js";import{a as g}from"./axios-L6U4YIEh.js";import{S as m}from"./sweetAlertStore-OSl3I7J_.js";import{S as E}from"./sweetalert2.all-RmH6BIgJ.js";import{u as j}from"./cartStore-e073FfKr.js";const W={class:"modal-dialog modal-xl",role:"document"},G={class:"modal-content border-0"},J={class:"modal-header bg-dark text-white"},K={class:"modal-title",id:"exampleModalLabel"},Q=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),X={class:"modal-body"},Y={class:"row"},Z={class:"col-sm-6"},tt=["src"],et={class:"col-sm-6"},st={class:"badge bg-primary rounded-pill"},ot={key:0,class:"h5"},at={key:1,class:"h6"},nt={key:2,class:"h5"},lt={class:"input-group"},dt={__name:"userProductModal",props:["product"],emits:["add-to-cart"],setup(V,{expose:_,emit:h}){const{openModal:$,hideModal:l,modalRef:M}=O(),u=V,C=h,f=x(1),d=()=>{C("add-to-cart",u.product.id,f.value),f.value=1};return _({openModal:$,hideModal:l}),(B,w)=>(s(),o("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalRef",ref:M},[t("div",W,[t("div",G,[t("div",J,[t("h5",K,[t("span",null,r(u.product.title),1)]),Q]),t("div",X,[t("div",Y,[t("div",Z,[(s(!0),o(P,null,S(u.product.imagesUrl,v=>(s(),o("img",{class:"img-fluid",src:v,alt:"",key:v.id,style:{height:"200px",width:"200px","background-size":"cover","padding-right":"5px"}},null,8,tt))),128))]),t("div",et,[t("span",st,r(u.product.category),1),t("p",null,"商品描述："+r(u.product.description),1),t("p",null,"商品內容："+r(u.product.content),1),u.product.price?i("",!0):(s(),o("div",ot,r(u.product.origin_price)+" 元",1)),u.product.price?(s(),o("del",at,"原價 "+r(u.product.origin_price)+" 元",1)):i("",!0),u.product.price?(s(),o("div",nt,"現在只要 "+r(u.product.price)+" 元",1)):i("",!0),t("div",null,[t("div",lt,[I(t("input",{type:"number",class:"form-control","onUpdate:modelValue":w[0]||(w[0]=v=>f.value=v),min:"1"},null,512),[[T,f.value,void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:d},"加入購物車(內)")])])])])])])])],512))}};var ct={VITE_APP_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_PATH:"aca101139",BASE_URL:"/HexVueW8HwAsk/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const it={class:"container"},rt={class:"mt-4"},ut={class:"table align-middle"},pt=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),_t={style:{width:"200px"}},ht={key:0,class:"h5"},gt={key:1,class:"h6"},mt={key:2,class:"h5"},vt={class:"btn-group btn-group-sm"},bt=["onClick","disabled"],yt={key:0,class:"fas fa-spinner fa-pulse"},ft=["onClick","disabled"],kt={key:0,class:"fas fa-spinner fa-pulse"},xt={key:0,class:"text-end"},$t=t("h2",null,"試試放一項商品到購物車中吧",-1),Ct=[$t],Mt={key:1,class:"text-end"},wt={key:2,class:"table align-middle"},Pt=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1),St=["onClick","disabled"],It={key:0,class:"fas fa-spinner fa-pulse"},Tt={key:0,class:"text-success"},Vt={class:"input-group input-group-sm"},Bt={class:"input-group mb-3"},Dt=["onUpdate:modelValue","onBlur","disabled"],Et={class:"input-group-text",id:"basic-addon2"},At={class:"text-end"},Rt={key:0,class:"text-success"},Ut=t("td",{colspan:"3",class:"text-end"},"總計",-1),Lt={class:"text-end"},qt={key:0},Ht=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),Nt={class:"text-end text-success"},zt={key:3,class:"input-group mb-3 input-group-sm"},Ft={key:4,class:"d-flex justify-content-end mb-5"},Qt={__name:"CartView",setup(V){const{VITE_APP_URL:_,VITE_APP_PATH:h}=ct,$=x(null),l=x({loadingItem:""}),M=x([]),u=x({}),C=x(""),f=j(),{carts:d}=q(f),B=()=>{const n=`${_}/api/${h}/products`;g.get(n).then(a=>{M.value=a.data.products}).catch(a=>{alert(a.response.data.message)})},w=n=>{const a=`${_}/api/${h}/product/${n}`;l.value.loadingItem=n,g.get(a).then(p=>{l.value.loadingItem="",u.value=p.data.product,$.value.openModal()}).catch(p=>{alert(p.response.data.message)})},v=(n,a=1)=>{const p=`${_}/api/${h}/cart`;l.value.loadingItem=n;const e={product_id:n,qty:a};$.value.hideModal(),g.post(p,{data:e}).then(()=>{l.value.loadingItem="",b(),m.showSuccessMsg("已加入購物車")}).catch(y=>{alert(y.response.data.message)})},A=n=>{l.value.loadingItem=n.id;const a=`${_}/api/${h}/cart/${n.id}`,p={product_id:n.product_id,qty:n.qty};g.put(a,{data:p}).then(()=>{m.showSuccessMsg("已更新購物車"),l.value.loadingItem="",b()}).catch(e=>{alert(e.response.data.message),l.value.loadingItem=""})},R=()=>{E.fire({title:"是否清空購物車?",showDenyButton:!0,confirmButtonText:"確認清空",denyButtonText:"再想想好了"}).then(a=>{a.isConfirmed?(m.showSuccessMsg("刪除成功"),g.delete(n).then(()=>{b()}).catch(p=>{alert(p.response.data.message)})):a.isDenied&&m.showErrorMsg("已為您保留購物車")}).catch(()=>{alert("伺服器錯誤")});const n=`${_}/api/${h}/carts`},b=()=>{const n=`${_}/api/${h}/cart`;g.get(n).then(a=>{d.value=a.data.data}).catch(a=>{alert(a.response.data.message)})},U=n=>{E.fire({title:"確認要刪除",showDenyButton:!0,confirmButtonText:"確認刪除",denyButtonText:"再想想好了"}).then(p=>{p.isConfirmed?(l.value.loadingItem=n,m.showSuccessMsg("刪除成功"),g.delete(a).then(()=>{l.value.loadingItem="",b()}).catch(e=>{alert(e.response.data.message)})):p.isDenied&&m.showErrorMsg("已為您保留該品項")});const a=`${_}/api/${h}/cart/${n}`},L=()=>{const n=`${_}/api/${h}/coupon`,a={code:C.value};l.value.loadingItem="",g.post(n,{data:a}).then(p=>{m.showSuccessMsg("已加入優惠券"),b(),l.value.loadingItem=""}).catch(()=>{l.value.loadingItem="",m.showErrorMsg("加入優惠券失敗"),b()})};return H(()=>{B(),b()}),(n,a)=>{const p=N("router-link");return s(),o("div",it,[t("div",rt,[D(dt,{ref_key:"userProductModalRef",ref:$,product:u.value,onAddToCart:v},null,8,["product"]),t("table",ut,[pt,t("tbody",null,[(s(!0),o(P,null,S(M.value,e=>(s(),o("tr",{key:e.id},[t("td",_t,[t("div",{style:F([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${e.imageUrl})`}])},null,4)]),t("td",null,r(e.title),1),t("td",null,[e.price?i("",!0):(s(),o("div",ht,r(e.origin_price)+" 元 ",1)),e.price?(s(),o("del",gt,"原價 "+r(e.origin_price)+" 元",1)):i("",!0),e.price?(s(),o("div",mt," 現在只要 "+r(e.price)+" 元 ",1)):i("",!0)]),t("td",null,[t("div",vt,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:y=>w(e.id),disabled:l.value.loadingItem===e.id||!e.is_enabled},[l.value.loadingItem===e.id?(s(),o("i",yt)):i("",!0),k(" 查看更多 ")],8,bt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:y=>v(e.id),disabled:l.value.loadingItem===e.id||!e.is_enabled},[l.value.loadingItem===e.id?(s(),o("i",kt)):i("",!0),k(" 加到購物車 ")],8,ft)])])]))),128))])]),c(d).carts&&c(d).carts.length===0?(s(),o("div",xt,Ct)):(s(),o("div",Mt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:R}," 清空購物車 ")])),c(d).carts&&c(d).carts.length!==0?(s(),o("table",wt,[Pt,t("tbody",null,[c(d).carts?(s(!0),o(P,{key:0},S(c(d).carts,e=>(s(),o("tr",{key:e.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:y=>U(e.id),disabled:l.value.loadingItem===e.id},[l.value.loadingItem===e.id?(s(),o("i",It)):i("",!0),k(" x ")],8,St)]),t("td",null,[k(r(e.product.title)+" ",1),e.coupon?(s(),o("div",Tt," 已套用優惠券 ")):i("",!0)]),t("td",null,[t("div",Vt,[t("div",Bt,[I(t("input",{"onUpdate:modelValue":y=>e.qty=y,onBlur:y=>A(e),disabled:l.value.loadingItem===e.id,min:"1",type:"number",class:"form-control"},null,40,Dt),[[T,e.qty,void 0,{number:!0}]]),t("span",Et,r(e.product.unit),1)])])]),t("td",At,[c(d).final_total!==c(d).total?(s(),o("small",Rt,"折扣價：")):i("",!0),k(" "+r(Math.floor(c(d).final_total)),1)])]))),128)):i("",!0)]),t("tfoot",null,[t("tr",null,[Ut,t("td",Lt,r(c(d).total),1)]),c(d).final_total!==c(d).total?(s(),o("tr",qt,[Ht,t("td",Nt,r(Math.floor(c(d).final_total)),1)])):i("",!0)])])):i("",!0),c(d).carts&&c(d).carts.length!==0?(s(),o("div",zt,[I(t("input",{type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),placeholder:"請輸入優惠碼"},null,512),[[T,C.value]]),t("div",{class:"input-group-append"},[t("button",{class:"btn btn-outline-secondary",type:"button",onClick:L}," 套用優惠碼 ")])])):i("",!0),c(d).carts&&c(d).carts.length!==0?(s(),o("div",Ft,[D(p,{to:"/checkOut",class:"btn btn-primary"},{default:z(()=>[k("去結帳")]),_:1})])):i("",!0)])])}}};export{Qt as default};
