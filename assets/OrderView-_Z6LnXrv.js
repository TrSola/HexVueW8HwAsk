import{h as r,i as S,a as l,c as s,e,t as a,m as M,F as y,j as P,n as R,y as O,r as T,b as g,q as U}from"./index-_CDjE_z8.js";import{a as C}from"./axios-L6U4YIEh.js";import{_ as B}from"./DelModal-rZ_dUw5d.js";import{u as I}from"./useModal-jwBhBEve.js";import{_ as H}from"./PaginationComponent-3hVzbtnU.js";import{S as N}from"./sweetalert2.all-6J5TDxSM.js";const j={class:"modal-dialog modal-xl",role:"document"},q={class:"modal-content border-0"},z=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),F={class:"modal-body"},W={class:"row"},G={class:"col-md-4"},J=e("h3",null,"用戶資料",-1),K={class:"table"},Q={key:0},X=e("th",{style:{width:"100px"}},"姓名",-1),Y=e("th",null,"Email",-1),Z=e("th",null,"電話",-1),ee=e("th",null,"地址",-1),te={class:"col-md-8"},le=e("h3",null,"訂單細節",-1),se={class:"table"},oe=e("th",{style:{width:"100px"}},"訂單編號",-1),ae=e("th",null,"下單時間",-1),ne=e("th",null,"付款時間",-1),de={key:0},ie={key:1},re=e("th",null,"付款狀態",-1),ue={key:0,class:"text-success"},ce={key:1,class:"text-muted"},_e=e("th",null,"總金額",-1),he=e("h3",null,"選購商品",-1),pe={class:"table"},ve=e("thead",null,[e("tr")],-1),me={class:"text-end"},fe={class:"d-flex justify-content-end"},be={class:"form-check"},ye={class:"form-check-label",for:"flexCheckDefault"},ke={key:0},$e={key:1},ge={class:"modal-footer"},xe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),we={__name:"OrderModal",props:{order:Object},emits:["update-paid"],setup(V,{expose:_,emit:m}){const{openModal:f,hideModal:b,modalRef:x}=I(),k=V,n=m,t=r({});return S(()=>k.order,c=>{t.value=c}),_({openModal:f,hideModal:b}),(c,h)=>(l(),s("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalRef",ref:x},[e("div",j,[e("div",q,[z,e("div",F,[e("div",W,[e("div",G,[J,e("table",K,[t.value.user?(l(),s("tbody",Q,[e("tr",null,[X,e("td",null,a(t.value.user.name),1)]),e("tr",null,[Y,e("td",null,a(t.value.user.email),1)]),e("tr",null,[Z,e("td",null,a(t.value.user.tel),1)]),e("tr",null,[ee,e("td",null,a(t.value.user.address),1)])])):M("",!0)])]),e("div",te,[le,e("table",se,[e("tbody",null,[e("tr",null,[oe,e("td",null,a(t.value.id),1)]),e("tr",null,[ae,e("td",null,a(c.$filters.date(t.value.create_at)),1)]),e("tr",null,[ne,e("td",null,[t.value.paid_date?(l(),s("span",de,a(c.$filters.date(t.value.paid_date)),1)):(l(),s("span",ie,"時間不正確"))])]),e("tr",null,[re,e("td",null,[t.value.is_paid?(l(),s("strong",ue,"已付款")):(l(),s("span",ce,"尚未付款"))])]),e("tr",null,[_e,e("td",null,a(c.$filters.currency(t.value.total)),1)])])]),he,e("table",pe,[ve,e("tbody",null,[(l(!0),s(y,null,P(t.value.products,d=>(l(),s("tr",{key:d.id},[e("th",null,a(d.product.title),1),e("td",null,a(d.qty)+" / "+a(d.product.unit),1),e("td",me,a(c.$filters.currency(d.final_total)),1)]))),128))])]),e("div",fe,[e("div",be,[R(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":h[0]||(h[0]=d=>t.value.is_paid=d)},null,512),[[O,t.value.is_paid]]),e("label",ye,[t.value.is_paid?(l(),s("span",ke,"已付款")):(l(),s("span",$e,"未付款"))])])])])])]),e("div",ge,[xe,e("button",{type:"button",class:"btn btn-primary",onClick:h[1]||(h[1]=d=>n("update-paid",t.value))}," 修改付款狀態 ")])])])],512))}};var Ce={VITE_APP_URL:"https://ec-course-api.hexschool.io/v2",VITE_APP_PATH:"aca101139",BASE_URL:"/HexVueW8HwAsk/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Me={class:"table mt-4"},Pe=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),Ve=["textContent"],Ee={class:"list-unstyled"},Re={class:"text-right"},Oe={class:"form-check form-switch"},De=["id","onUpdate:modelValue","onChange"],Le=["for"],Ae={key:0},Se={key:1},Te={class:"btn-group"},Ue=["onClick"],Be=["onClick"],Fe={__name:"OrderView",setup(V){const _=N.mixin({toast:!0,position:"center",iconColor:"white",customClass:{popup:"colored-toast"},showConfirmButton:!1,timer:1500,timerProgressBar:!0}),m=r(null),f=r(null),b=r({}),x=r(!1),k=r({}),n=r(!1),t=r({}),c=r({}),h=r(1),{VITE_APP_URL:d,VITE_APP_PATH:w}=Ce,$=(i=1)=>{const p=`${d}/api/${w}/admin/orders?page=${i}`;n.value=!0,C.get(p,c).then(v=>{b.value=v.data.orders,k.value=v.data.pagination,n.value=!1}).catch(()=>{n.value=!1,_.fire({icon:"warning",title:"取得訂單失敗"})})},D=i=>{t.value={...i},x.value=!1,m.value.openModal()},L=i=>{t.value={...i},f.value.openModal()},E=i=>{const p=`${d}/api/${w}/admin/order/${i.id}`,v={is_paid:i.is_paid};n.value=!0,C.put(p,{data:v}).then(o=>{n.value=!1,m.value.hideModal(),$(h.value),_.fire({icon:"success",title:"修改付款狀態成功"})}).catch(o=>{n.value=!1,_.fire({icon:"warning",title:o.response.data.message})})},A=()=>{const i=`${d}/api/${w}/admin/order/${t.value.id}`;n.value=!0,C.delete(i).then(p=>{n.value=!1,f.value.hideModal(),$(h.value),_.fire({icon:"success",title:"刪除訂單成功"})}).catch(p=>{n.value=!1,_.fire({icon:"warning",title:p.response.data.message})})};return $(),(i,p)=>{const v=T("VueLoading");return l(),s(y,null,[g(v,{active:n.value,"z-index":1060},null,8,["active"]),e("table",Me,[Pe,e("tbody",null,[(l(!0),s(y,null,P(b.value,o=>(l(),s(y,{key:o.id},[b.value.length?(l(),s("tr",{key:0,class:U({"text-secondary":!o.is_paid})},[e("td",null,a(i.$filters.date(o.create_at)),1),e("td",null,[o.user?(l(),s("span",{key:0,textContent:a(o.user.email)},null,8,Ve)):M("",!0)]),e("td",null,[e("ul",Ee,[(l(!0),s(y,null,P(o.products,u=>(l(),s("li",{key:u.id},a(u.product.title)+" 數量："+a(u.qty)+" "+a(u.product.unit),1))),128))])]),e("td",Re,a(o.total),1),e("td",null,[e("div",Oe,[R(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${o.id}`,"onUpdate:modelValue":u=>o.is_paid=u,onChange:u=>E(o)},null,40,De),[[O,o.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${o.id}`},[o.is_paid?(l(),s("span",Ae,"已付款")):(l(),s("span",Se,"未付款"))],8,Le)])]),e("td",null,[e("div",Te,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:u=>D(o)}," 檢視 ",8,Ue),e("button",{class:"btn btn-outline-warning btn-sm",type:"button",onClick:u=>L(o)}," 刪除 ",8,Be)])])],2)):M("",!0)],64))),128))])]),g(we,{order:t.value,ref_key:"orderModalRef",ref:m,onUpdatePaid:E},null,8,["order"]),g(B,{item:t.value,ref_key:"delModalRef",ref:f,onDelItem:A},null,8,["item"]),g(H,{pages:k.value,onEmitPages:$},null,8,["pages"])],64)}}};export{Fe as default};
